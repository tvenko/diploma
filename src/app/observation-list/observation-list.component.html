<app-main-navbar></app-main-navbar>

<h3>Testni seznam meritev</h3>
<hr>

<form>
  <md-select placeholder="Pacient" [(ngModel)]="patient" name="patient">
    <md-option *ngFor="let patient of patients" [value]="patient" (click)="getObservations()">
      <img [src]="patient.resource.photo[0].url" alt="avatar" class="avatar img-circle"> {{ patient.resource.name[0]?.given[0] }} {{ patient.resource.name[0]?.family }}
    </md-option>
  </md-select>
</form>

<!-- izpis seznama meritev -->
<div class="card-container" *ngIf="patient">
  <div *ngFor="let observation of observations; let i = index">
    <md-card *ngIf="observation.resource.category">
      <div *ngIf="!(observation.resource.code?.text == 'Blood Pressure')">
        <md-card-title>
          <img [src]="observation.patient?.photo[0]?.url" alt="avatar" class="avatar img-circle">
          {{ observation.patient?.name[0]?.given[0] }} {{ observation.patient?.name[0]?.family }}
        </md-card-title>
        <md-card-content class="card-container">
          ID: {{ observation.resource.id }} <br>
          TYPE: {{ observation.resource.code?.text }} <br>
          VALUE: {{ observation.resource.valueQuantity?.value }} {{ observation.resource.valueQuantity?.unit }} <br>
          DATE: {{ observation.resource.meta?.lastUpdated | date}}
        </md-card-content>
        <md-card-actions align="end">
          <button md-button color="primary" (click)="onDelete(observation, i)">IZBRIŠI</button>
        </md-card-actions>
      </div>

      <div *ngIf="observation.resource.code?.text == 'Blood Pressure'">
        <md-card-title>
          <img [src]="observation.patient?.photo[0]?.url" alt="avatar" class="avatar img-circle">
          {{ observation.patient?.name[0]?.given[0] }} {{ observation.patient?.name[0]?.family }}
        </md-card-title>
        <md-card-content class="card-container">
          ID: {{ observation.resource.id }} <br>
          TYPE: {{ observation.resource.component[0].code?.text }} <br>
          VALUE: {{ observation.resource.component[0].valueQuantity?.value }} {{ observation.resource.component[0].valueQuantity?.unit }} <br>
          <br>
          TYPE: {{ observation.resource.component[1].code?.text }} <br>
          VALUE: {{ observation.resource.component[1].valueQuantity?.value }} {{ observation.resource.component[0].valueQuantity?.unit }} <br>
          DATE: {{ observation.resource.meta?.lastUpdated | date}}
          <br>
        </md-card-content>
        <md-card-actions align="end">
          <button md-button color="primary" (click)="onDelete(observation, i)">IZBRIŠI</button>
        </md-card-actions>
      </div>
    </md-card>
  </div>
</div>

<div *ngIf="!patient">
  <p>Prosim izberite pacienta</p>
</div>

<!-- ce je prislo do napake -->
<div *ngIf="observationsError">
  Meritev ni bilo mogoče pridobiti.
</div>

<!-- spinner dokler cakas na meritve -->
<div *ngIf="observationsWaiting">
  <md-spinner color="accent" style="height: 50px;"></md-spinner>
</div>

<!-- paginacija -->
<div class="text-center">
  <ngb-pagination
    [collectionSize]=total
    [(page)]="page"
    [maxSize]="5"
    [rotate]="true"
    [boundaryLinks]="true"
    (click)="getObservations()">
  </ngb-pagination>
</div>
